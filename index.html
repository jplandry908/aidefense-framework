<!DOCTYPE html>
<html lang="en" class="dark">

<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-CE533C5J6V"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-CE533C5J6V');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIDEFEND Framework</title>
    <script src="./js/tailwindcss.js"></script>
    <script src="./js/purify.min.js"></script>
    <style>
        :root {
            /* Light Theme */
            --bg-color: #f0f2f5;
            --text-color: #37474f;
            --text-secondary-color: #607d8b;
            --header-bg: #ffffff;
            --header-border: #e0e0e0;
            --column-bg: #ffffff;
            --column-border: #e0e0e0;
            --column-header-text: #455a64;
            --column-header-hover-text: #1976d2;
            --technique-item-bg: #ffffff;
            --technique-item-border: #e8eaf6;
            --technique-item-text: #2196f3;
            --technique-item-hover-bg: #e3f2fd;
            --technique-item-hover-text: #1565c0;
            --technique-item-highlight-bg: #bbdefb;
            --technique-item-highlight-text: #0d47a1;
            --technique-id-text: #78909c;
            --subtechnique-bg: #fafafa;
            --modal-content-bg: #ffffff;
            --modal-close-btn-text: #757575;
            --modal-close-btn-hover-text: #212121;
            --search-bg: #eceff1;
            --search-border: #b0bec5;
            --search-focus-ring: #2196f3;
            --scrollbar-track: #e0e0e0;
            --scrollbar-thumb: #90a4ae;
            --scrollbar-thumb-hover: #78909c;
            --icon-fill: #607d8b;
            --icon-hover-fill: #2196f3;
            --link-color: #1976d2;
            --link-hover-color: #0d47a1;
            --shadow-umbra: rgba(0, 0, 0, 0.15);
            --shadow-penumbra: rgba(0, 0, 0, 0.1);
            --shadow-ambient: rgba(0, 0, 0, 0.08);
            --footer-bg: #e0e0e0;
            --footer-text: #757575;
            --footer-border: #c0c0c0;
            --view-switcher-bg: #e8eaf6;
            --view-switcher-btn-bg: #ffffff;
            --view-switcher-btn-text: #546e7a;
            --view-switcher-btn-active-bg: #3f51b5;
            --view-switcher-btn-active-text: #ffffff;
        }

        html.dark {
            /* Dark Theme */
            --bg-color: #1a1a1a;
            --text-color: #e0e0e0;
            --text-secondary-color: #b0b0b0;
            --header-bg: #222222;
            --header-border: #333333;
            --column-bg: #222222;
            --column-border: #333333;
            --column-header-text: #f0f0f0;
            --column-header-hover-text: #90caf9;
            --technique-item-bg: #2b2b2b;
            --technique-item-border: #3d3d3d;
            --technique-item-text: #90caf9;
            --technique-item-hover-bg: #383838;
            --technique-item-hover-text: #bbdefb;
            --technique-item-highlight-bg: #1e3a5f;
            --technique-item-highlight-text: #e3f2fd;
            --technique-id-text: #c0c0c0;
            --subtechnique-bg: #252525;
            --modal-content-bg: #222222;
            --modal-close-btn-text: #b0b0b0;
            --modal-close-btn-hover-text: #f0f0f0;
            --search-bg: #333333;
            --search-border: #444444;
            --search-focus-ring: #90caf9;
            --scrollbar-track: #2b2b2b;
            --scrollbar-thumb: #555555;
            --scrollbar-thumb-hover: #777777;
            --icon-fill: #c0c0c0;
            --icon-hover-fill: #90caf9;
            --link-color: #90caf9;
            --link-hover-color: #e3f2fd;
            --shadow-umbra: rgba(0, 0, 0, 0.5);
            --shadow-penumbra: rgba(0, 0, 0, 0.35);
            --shadow-ambient: rgba(0, 0, 0, 0.3);
            --footer-bg: #2b2b2b;
            --footer-text: #a0a0a0;
            --footer-border: #3d3d3d;
            --view-switcher-bg: #333333;
            --view-switcher-btn-bg: #424242;
            --view-switcher-btn-text: #e0e0e0;
            --view-switcher-btn-active-bg: #90caf9;
            --view-switcher-btn-active-text: #121212;
        }

        html {
            height: 100%;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: background-color 0.3s ease, color 0.3s ease;
            min-height: 100%;
            display: flex;
            flex-direction: column;
        }

        #page-container {
            flex: 1 0 auto;
        }

        footer {
            flex-shrink: 0;
        }

        body.modal-open {
            overflow: hidden;
        }

        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--scrollbar-track);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--scrollbar-thumb);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--scrollbar-thumb-hover);
        }

        .elevation-2 {
            box-shadow: 0px 3px 1px -2px var(--shadow-umbra), 0px 2px 2px 0px var(--shadow-penumbra), 0px 1px 5px 0px var(--shadow-ambient);
        }

        .elevation-4 {
            box-shadow: 0px 2px 4px -1px var(--shadow-umbra), 0px 4px 5px 0px var(--shadow-penumbra), 0px 1px 10px 0px var(--shadow-ambient);
        }

        .elevation-8 {
            box-shadow: 0px 5px 5px -3px var(--shadow-umbra), 0px 8px 10px 1px var(--shadow-penumbra), 0px 3px 14px 2px var(--shadow-ambient);
        }

        .header-main {
            background-color: var(--header-bg);
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }

        .header-title {
            font-size: 2rem;
            font-weight: 500;
            color: var(--text-color);
        }

        .header-subtitle {
            font-size: 0.875rem;
            color: var(--text-secondary-color);
        }

        .search-input-wrapper {
            position: relative;
            display: flex;
            align-items: center;
        }

        .search-container input {
            background-color: var(--search-bg);
            border: 1px solid var(--search-border);
            color: var(--text-color);
            border-radius: 0.5rem;
            padding-right: 2.5rem;
        }

        .search-container input::placeholder {
            color: var(--text-secondary-color);
        }

        .search-container input:focus {
            --tw-ring-color: var(--search-focus-ring);
            border-color: var(--search-focus-ring);
            box-shadow: 0 0 0 2px var(--search-focus-ring);
        }

        .search-clear-button {
            position: absolute;
            right: 0.5rem;
            padding: 0.25rem;
            color: var(--text-secondary-color);
            cursor: pointer;
            display: none;
        }

        .search-clear-button:hover {
            color: var(--text-color);
        }

        .search-clear-button svg {
            width: 1.25rem;
            height: 1.25rem;
        }

        .header-button {
            background-color: transparent;
            color: var(--icon-fill);
            border: none;
            padding: 0.625rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .header-button:hover {
            background-color: rgba(0, 0, 0, 0.04);
            color: var(--icon-hover-fill);
        }

        html.dark .header-button:hover {
            background-color: rgba(255, 255, 255, 0.08);
        }

        .header-button svg {
            width: 1.5rem;
            height: 1.5rem;
            fill: currentColor;
            margin-right: 0;
        }

        .header-button.text-button {
            padding: 0.5rem 1rem;
            border-radius: 0.25rem;
            font-weight: 500;
        }

        .header-button.text-button svg {
            margin-right: 0.5rem;
            width: 1.25rem;
            height: 1.25rem;
        }

        .matrix-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 0.28rem;
            padding: 1.0rem 0.5rem;
            align-items: flex-start;
            justify-content: center;
        }

        .matrix-column {
            flex-grow: 0;
            flex-shrink: 0;
            min-width: 170px;
            background-color: var(--column-bg);
            border-radius: 0.75rem;
            padding: 0.6rem;
            min-height: 200px;
            transition: background-color 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease;
            display: flex;
            flex-direction: column;
        }

        .column-header {
            font-size: 1.25rem;
            font-weight: 500;
            color: var(--column-header-text);
            margin-bottom: 1rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid var(--column-border);
            transition: color 0.3s ease, border-color 0.3s ease;
            cursor: pointer;
            text-align: center;
        }

        .column-header:hover {
            color: var(--column-header-hover-text);
        }

        .technique-container {
            margin-bottom: 0.75rem;
        }

        /* --- UI/UX IMPROVEMENT START --- */
        .technique-item {
            display: flex;
            /*justify-content: space-between;*/
            align-items: center;
            /* Vertically center content and icon */
            background-color: var(--technique-item-bg);
            position: relative;
            /* Add this */
            padding: 0.75rem 2.5rem 0.75rem 1rem;
            font-size: 0.875rem;
            color: var(--technique-item-text);
            border-radius: 0.5rem;
            cursor: pointer;
            transition: background-color 0.2s ease-in-out, color 0.2s ease-in-out, transform 0.2s ease, box-shadow 0.2s ease;
            line-height: 1.5;
            min-height: 60px;
            /* Ensures consistent height */
        }

        /* --- UI/UX IMPROVEMENT END --- */

        .technique-item-content {
            flex-grow: 1;
        }

        .technique-item:hover {
            background-color: var(--technique-item-hover-bg);
            color: var(--technique-item-hover-text);
            transform: translateY(-2px);
        }

        .technique-item.highlight {
            background-color: var(--technique-item-highlight-bg);
            color: var(--technique-item-highlight-text);
            font-weight: 600;
        }

        .subtechnique-item.highlight {
            background-color: var(--technique-item-highlight-bg) !important;
            color: var(--technique-item-highlight-text) !important;
            font-weight: 600;
        }

        .technique-id {
            font-weight: 500;
            color: var(--technique-id-text);
            font-size: 0.75rem;
            margin-right: 0.35rem;
            display: block;
            margin-bottom: 0.125rem;
        }

        .technique-name {
            font-weight: 500;
            max-width: 140px;
        }

        .technique-item.no-sub .technique-name {
            max-width: 100%;
            /* Or you could set a larger value like '100%' */
        }

        .expand-icon {
            position: absolute;
            /* Add this */
            right: 0.1rem;
            /* Add this: Positions it 1rem from the right edge */
            top: 50%;
            /* Add this: Centers it vertically */
            transform: translateY(-50%);
            /* Add this: Fine-tunes vertical centering */
            flex-shrink: 0;
            width: 1.25rem;
            height: 1.25rem;
            transition: transform 0.3s ease;
            /* margin-left: 1rem; */
            /* This can be removed */
        }

        .expand-icon.expanded {
            transform: rotate(45deg);
        }

        /* --- UI/UX IMPROVEMENT START --- */
        .sub-technique-list {
            list-style-type: none;
            padding-left: 1rem;
            /* Indent the list */
            margin-top: 0.5rem;
            margin-left: 0.75rem;
            /* Align with parent padding */
            border-left: 2px solid var(--technique-item-border);
            /* Connecting line */
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s cubic-bezier(0.25, 0.1, 0.25, 1);
        }

        /* --- UI/UX IMPROVEMENT END --- */

        .sub-technique-list.expanded {
            max-height: 1000px;
        }

        /* --- UI/UX IMPROVEMENT START --- */
        .subtechnique-item {
            display: block;
            background-color: var(--subtechnique-bg);
            padding: 0.6rem 0.8rem;
            font-size: 0.8rem;
            color: var(--technique-item-hover-text);
            border-radius: 0.375rem;
            /* Removed the thick left border to rely on the list's border */
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            line-height: 1.4;
            margin-bottom: 0.5rem;
        }

        /* --- UI/UX IMPROVEMENT END --- */

        .subtechnique-item:hover {
            background-color: var(--technique-item-hover-bg);
            color: var(--technique-item-hover-text);
            transform: translateX(3px);
        }

        .subtechnique-item .technique-id {
            font-size: 0.7rem;
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.2s ease, visibility 0.2s ease;
        }

        html.dark .modal-overlay {
            background-color: rgba(0, 0, 0, 0.7);
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background-color: var(--modal-content-bg);
            color: var(--text-color);
            padding: 2rem;
            border-radius: 0.5rem;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            transition: background-color 0.3s ease, color 0.3s ease, transform 0.2s ease;
            transform: scale(0.95);
        }

        .modal-overlay.active .modal-content {
            transform: scale(1);
        }

        .modal-content h2.modal-main-title {
            font-size: 1.75rem;
            font-weight: 500;
            margin-bottom: 1rem;
            /* Reduced margin */
            color: var(--column-header-hover-text);
        }

        .modal-content h2 {
            font-size: 1.5rem;
            font-weight: 500;
            margin-bottom: 1rem;
            color: var(--column-header-hover-text);
        }

        .modal-content h3 {
            font-size: 1.25rem;
            font-weight: 500;
            margin-top: 1.5rem;
            margin-bottom: 0.75rem;
            color: var(--text-color);
        }

        .modal-content h4 {
            font-size: 1rem;
            font-weight: 500;
            margin-top: 1rem;
            margin-bottom: 0.5rem;
            color: var(--text-color);
        }

        .modal-content h5 {
            font-size: 0.9rem;
            font-weight: 600;
            margin-top: 0.75rem;
            margin-bottom: 0.25rem;
            color: var(--text-color);
        }

        .modal-content p {
            font-size: 0.9375rem;
            line-height: 1.7;
            margin-bottom: 1rem;
        }

        .modal-content ul {
            list-style-type: disc;
            margin-left: 1.5rem;
            font-size: 0.9375rem;
            line-height: 1.7;
            margin-bottom: 1rem;
        }

        .modal-content ul ul {
            margin-top: 0.5rem;
            margin-bottom: 0.5rem;
        }

        /* Controls line spacing for list items including defendsAgainst items */
        .modal-content li {
            margin-bottom: 0.25rem;
        }

        .modal-content a {
            color: var(--link-color);
            text-decoration: none;
            font-weight: 500;
        }

        .modal-content a:hover {
            color: var(--link-hover-color);
            text-decoration: underline;
        }

        .modal-content code {
            font-family: monospace;
            background-color: var(--search-bg);
            padding: 0.1rem 0.3rem;
            border-radius: 0.25rem;
            font-size: 0.8rem;
        }

        .modal-content pre {
            background-color: var(--search-bg);
            padding: 0.75rem;
            border-radius: 0.5rem;
            margin: 0.5rem 0;
            overflow-x: auto;
        }

        .modal-content pre code {
            padding: 0;
            background: none;
        }

        .modal-close-button {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            font-size: 1.75rem;
            color: var(--modal-close-btn-text);
            cursor: pointer;
            line-height: 1;
            transition: color 0.3s ease;
            padding: 0.25rem;
        }

        .modal-close-button:hover {
            color: var(--modal-close-btn-hover-text);
        }

        /* Framework title styling (MITRE ATLAS, MAESTRO, OWASP, etc.)
           - font-size: controls title size
           - margin-bottom: controls gap between title and first item */
        .modal-content p.defends-against-framework {
            font-size: 1rem;
            font-weight: 600;
            color: var(--technique-item-text);
            opacity: 0.9;
            margin-bottom: 0;
        }

        /* Defends Against list items styling
           - font-size: controls item text size
           - border-spacing: controls gap between items (vertical)
           - line-height: controls line height within each item */
        .defends-against-list {
            display: table;
            border-collapse: separate;
            border-spacing: 0 8px;
            margin-left: 1rem;
            font-size: 0.875rem;
            line-height: 1.7;
        }

        .defends-against-item {
            display: table-row;
        }

        .defends-against-item::before {
            content: '•';
            display: table-cell;
            width: 1rem;
            text-align: left;
        }

        .defends-against-item-text {
            display: table-cell;
        }

        .site-footer {
            background-color: var(--footer-bg);
            color: var(--footer-text);
            padding: 1rem 1rem;
            text-align: center;
            font-size: 0.875rem;
            border-top: 1px solid var(--footer-border);
            margin-top: auto;
        }

        .site-footer p {
            margin-bottom: 0.25rem;
            line-height: 1.5;
        }

        .accordion-item {
            border-bottom: 1px solid var(--header-border);
        }

        .accordion-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.25rem 0.5rem;
            cursor: pointer;
            font-size: 1.125rem;
            font-weight: 500;
            color: var(--text-color);
            transition: color 0.2s ease;
        }

        .accordion-header:hover {
            color: var(--column-header-hover-text);
        }

        .accordion-icon {
            width: 1.25rem;
            height: 1.25rem;
            transition: transform 0.3s ease-in-out;
            flex-shrink: 0;
            margin-left: 1rem;
        }

        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-in-out, padding 0.3s ease-in-out;
            font-size: 0.9375rem;
            line-height: 1.7;
            color: var(--text-secondary-color);
        }

        .accordion-content-inner {
            padding: 0 0.5rem 1.25rem 0.5rem;
        }

        .strategy-accordion-container {
            margin-top: 0.5rem;
        }

        .strategy-accordion-item {
            border-bottom: 1px solid var(--column-border);
        }

        .strategy-accordion-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 0.5rem;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .strategy-accordion-header:hover {
            color: var(--technique-item-hover-text);
        }

        .strategy-accordion-icon {
            width: 1rem;
            height: 1rem;
            transition: transform 0.3s ease-in-out;
            flex-shrink: 0;
            margin-left: 0.5rem;
        }

        .strategy-accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-in-out;
        }

        .strategy-accordion-content-inner {
            padding: 0.5rem 0.5rem 1rem 1rem;
            font-size: 0.85rem;
            line-height: 1.6;
            color: var(--text-secondary-color);
        }

        .warning-note {
            background-color: #f0f4f8;
            border-left: 4px solid #4a90e2;
            padding: 12px 18px;
            margin: 16px 0;
            border-radius: 4px;
            font-size: 0.9em;
            line-height: 1.6;
        }

        html.dark .warning-note {
            background-color: #2c3e50;
            border-left-color: #5dade2;
        }

        .warning-note p {
            margin: 0;
            padding: 0;
        }

        .warning-note strong {
            color: var(--text-color);
        }

        .view-switcher-container {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .view-by-label {
            color: var(--text-color);
            transition: color 0.2s ease;
        }

        .view-by-label:hover {
            color: var(--column-header-hover-text);
        }

        .view-switcher {
            background-color: var(--view-switcher-bg);
            border-radius: 0.5rem;
            padding: 0.25rem;
            display: inline-flex;
            align-items: center;
        }

        .view-switcher-btn {
            padding: 0.5rem 1rem;
            border: none;
            background-color: var(--view-switcher-btn-bg);
            color: var(--view-switcher-btn-text);
            border-radius: 0.375rem;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            margin: 0 0.125rem;
        }

        .view-switcher-btn.active {
            background-color: var(--view-switcher-btn-active-bg);
            color: var(--view-switcher-btn-active-text);
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
        }

        html.dark .view-switcher-btn.active {
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.4), 0 1px 2px 0 rgba(0, 0, 0, 0.2);
        }

        .view-info-tabs {
            display: flex;
            border-bottom: 1px solid var(--column-border);
            margin-bottom: 1.5rem;
        }

        .view-info-tab {
            padding: 0.75rem 1.25rem;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            border: none;
            background-color: transparent;
            color: var(--text-secondary-color);
            border-bottom: 2px solid transparent;
            margin-bottom: -1px;
            transition: color 0.2s, border-color 0.2s;
        }

        .view-info-tab:hover {
            color: var(--text-color);
        }

        .view-info-tab.active {
            color: var(--technique-item-text);
            border-bottom-color: var(--technique-item-text);
        }

        .view-info-tab-content {
            display: none;
        }

        .view-info-tab-content.active {
            display: block;
        }

        .view-info-card {
            background-color: var(--technique-item-bg);
            border: 1px solid var(--technique-item-border);
            border-radius: 0.75rem;
            padding: 1.25rem;
        }

        .view-info-card h3 {
            color: var(--technique-item-text);
            font-size: 1.25rem;
            margin-top: 0;
            margin-bottom: 0.75rem;
        }

        .view-info-card .view-question {
            color: var(--technique-item-text);
            margin-bottom: 1rem;
            display: block;
        }

        .view-info-card .view-focus-text {
            margin-bottom: 1.5rem;
            flex-grow: 1;
        }

        .view-info-card .view-detail {
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
            margin-top: 1rem;
        }

        .view-info-card .view-detail-icon {
            flex-shrink: 0;
            width: 1.25rem;
            height: 1.25rem;
            color: var(--technique-item-text);
            margin-top: 0.125rem;
        }

        .view-info-card .view-detail-content {
            font-size: 0.9rem;
            line-height: 1.6;
        }

        .view-info-card .view-detail-content strong {
            color: var(--text-color);
            font-weight: 600;
        }

        @media (max-width: 768px) {
            .view-cards-container {
                grid-template-columns: 1fr;
            }
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>

<body class="text-gray-800">
    <div id="page-container">
        <header class="header-main py-4 px-6 fixed top-0 left-0 right-0 z-50 elevation-4">
            <div class="mx-auto" style="max-width: 1600px;">
                <div class="flex flex-col md:flex-row justify-between items-center mb-3">
                    <div class="text-center md:text-left mb-3 md:mb-0">
                        <h1 class="header-title">
                            <a href="https://edward-playground.github.io/aidefense-framework/" class="no-underline">
                                AIDEFEND
                            </a>
                        </h1>
                        <p class="header-subtitle">A Practical Knowledge Base for AI Security Defenses</p>
                        <p class="text-xs text-gray-400 mt-0.5 header-version-text" id="framework-version">Version</p>
                    </div>
                    <div class="flex flex-wrap justify-center md:justify-end items-center gap-1">
                        <button id="aboutBtn" class="header-button text-button" title="About AIDEFEND">
                            About
                        </button>
                        <a href="https://github.com/edward-playground/aidefense-framework" target="_blank"
                            rel="noopener noreferrer" id="githubLink" class="header-button text-button"
                            title="View AIDEFEND on GitHub">
                            <span class="hidden lg:inline">View AIDEFEND on GitHub</span>
                            <span class="inline lg:hidden">GitHub</span>
                        </a>
                        <a href="https://github.com/edward-playground/aidefend-mcp" target="_blank"
                            rel="noopener noreferrer" id="mcpLink" class="header-button text-button"
                            title="View MCP Service on GitHub">
                            <span class="hidden lg:inline">View MCP Service on GitHub</span>
                            <span class="inline lg:hidden">MCP Service</span>
                        </a>
                        <button id="themeToggleBtn" class="header-button" title="Toggle Theme">
                        </button>
                    </div>
                </div>
                <div class="flex flex-col sm:flex-row justify-between items-center">
                    <div id="view-switcher-container" class="view-switcher-container mb-2 sm:mb-0">
                        <button id="viewInfoBtn"
                            class="font-semibold text-sm mr-2 shrink-0 view-by-label cursor-pointer">View by:</button>
                        <div id="view-switcher" class="view-switcher">
                            <button class="view-switcher-btn active" data-view="tactic">Tactics</button>
                            <button class="view-switcher-btn" data-view="pillar">Pillars</button>
                            <button class="view-switcher-btn" data-view="phase">Phases</button>
                        </div>
                    </div>
                    <div class="search-input-wrapper search-container flex-grow w-full sm:w-auto sm:ml-4">
                        <input type="text" id="search-bar"
                            placeholder="Search keywords, AIDEFEND/ATLAS techniques, MAESTRO threats, OWASP Top10s, Cisco, NIST AML, etc..."
                            class="w-full p-2.5 text-sm">
                        <button id="searchClearBtn" class="search-clear-button" title="Clear search">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"
                                class="w-5 h-5">
                                <path fill-rule="evenodd"
                                    d="M10 18a8 8 0 100-16 8 8 0 000 16ZM8.28 7.22a.75.75 0 00-1.06 1.06L8.94 10l-1.72 1.72a.75.75 0 101.06 1.06L10 11.06l1.72 1.72a.75.75 0 101.06-1.06L11.06 10l1.72-1.72a.75.75 0 00-1.06-1.06L10 8.94 8.28 7.22Z"
                                    clip-rule="evenodd" />
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </header>
        <div id="content-wrapper" class="pt-48 px-4 sm:px-6 lg:px-4 pb-8">
            <main id="main-content" class="mx-auto w-full"></main>
        </div>
    </div>
    <div id="infoModal" class="modal-overlay">
        <div id="modalBackdrop" class="absolute inset-0"></div>
        <div class="modal-content elevation-8">
            <button id="modalClose" class="modal-close-button">&times;</button>
            <div id="modalBody"></div>
        </div>
    </div>
    <footer class="site-footer">
        <p>AIDEFEND, An AI-focused defensive countermeasures knowledge base.</p>
        <p>Information based on the <a
                href="https://cloudsecurityalliance.org/blog/2025/02/06/agentic-ai-threat-modeling-framework-maestro"
                target="_blank" rel="noopener noreferrer" class="text-sky-600 dark:text-sky-400 hover:underline">MAESTRO
                framework</a>, <a href="https://d3fend.mitre.org/" target="_blank" rel="noopener noreferrer"
                class="text-sky-600 dark:text-sky-400 hover:underline">MITRE D3FEND</a>, <a
                href="https://atlas.mitre.org/" target="_blank" rel="noopener noreferrer"
                class="text-sky-600 dark:text-sky-400 hover:underline">ATLAS</a>, <a href="https://attack.mitre.org/"
                target="_blank" rel="noopener noreferrer"
                class="text-sky-600 dark:text-sky-400 hover:underline">ATT&CK</a>, <a href="https://saif.google/"
                target="_blank" rel="noopener noreferrer" class="text-sky-600 dark:text-sky-400 hover:underline">Google
                Secure AI Framework</a>, <a
                href="https://owasp.org/www-project-top-10-for-large-language-model-applications/" target="_blank"
                rel="noopener noreferrer" class="text-sky-600 dark:text-sky-400 hover:underline">OWASP Top 10 LLM
                2025</a>/<a href="https://owasp.org/www-project-machine-learning-security-top-10/" target="_blank"
                rel="noopener noreferrer" class="text-sky-600 dark:text-sky-400 hover:underline">ML Security
                2023</a>/<a href="https://genai.owasp.org/resource/owasp-top-10-for-agentic-applications-for-2026/" target="_blank"
                rel="noopener noreferrer" class="text-sky-600 dark:text-sky-400 hover:underline">Agentic
                2026</a>, <a href="https://learn-cloudsecurity.cisco.com/ai-security-framework" target="_blank"
                rel="noopener noreferrer" class="text-sky-600 dark:text-sky-400 hover:underline">Cisco AI Security Framework</a>, and <a
                href="https://csrc.nist.gov/pubs/ai/100/2/e2025/final" target="_blank"
                rel="noopener noreferrer" class="text-sky-600 dark:text-sky-400 hover:underline">NIST AML 2025</a>.</p>
        <p>2025 Edward's Playground - AIDEFEND framework Initiative. For informational purposes only.</p>
        <p>All content on this website is licensed under the <a href="https://creativecommons.org/licenses/by/4.0/"
                target="_blank" rel="noopener noreferrer"
                class="text-sky-600 dark:text-sky-400 hover:underline">Creative Commons Attribution 4.0 International
                License (CC BY 4.0)</a></p>
    </footer>
    <script type="module">
        // 從您的主檔案導入 aidefendData
        import { aidefendData } from './main.js';

        // 在這個模組作用域內使用 aidefendData 
        window.onload = function () {
            const elements = {
                mainContent: document.getElementById('main-content'),
                searchBar: document.getElementById('search-bar'),
                searchClearBtn: document.getElementById('searchClearBtn'),
                modal: document.getElementById('infoModal'),
                modalBackdrop: document.getElementById('modalBackdrop'),
                modalBody: document.getElementById('modalBody'),
                modalClose: document.getElementById('modalClose'),
                themeToggleBtn: document.getElementById('themeToggleBtn'),
                aboutBtn: document.getElementById('aboutBtn'),
                html: document.documentElement,
                viewSwitcher: document.getElementById('view-switcher'),
                viewInfoBtn: document.getElementById('viewInfoBtn')
            };
            const icons = {
                plus: `<svg class="accordion-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M10.75 4.75a.75.75 0 00-1.5 0v4.5h-4.5a.75.75 0 000 1.5h4.5v4.5a.75.75 0 001.5 0v-4.5h4.5a.75.75 0 000-1.5h-4.5v-4.5z" /></svg>`,
                minus: `<svg class="accordion-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M4 10a.75.75 0 01.75-.75h10.5a.75.75 0 010 1.5H4.75A.75.75 0 014 10z" clip-rule="evenodd" /></svg>`,
                sun: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2.25a.75.75 0 01.75.75v2.25a.75.75 0 01-1.5 0V3a.75.75 0 01.75-.75zM7.5 12a4.5 4.5 0 119 0 4.5 4.5 0 01-9 0zM18.894 6.166a.75.75 0 00-1.06-1.06l-1.591 1.59a.75.75 0 101.06 1.061l1.591-1.59zM21.75 12a.75.75 0 01-.75.75h-2.25a.75.75 0 010-1.5H21a.75.75 0 01.75.75zM17.834 18.894a.75.75 0 001.06-1.06l-1.59-1.591a.75.75 0 10-1.061 1.06l1.59 1.591zM12 18a.75.75 0 01.75.75V21a.75.75 0 01-1.5 0v-2.25A.75.75 0 0112 18zM7.758 17.303a.75.75 0 00-1.061-1.06l-1.591 1.59a.75.75 0 001.06 1.061l1.591-1.59zM6 12a.75.75 0 01-.75.75H3a.75.75 0 010-1.5h2.25A.75.75 0 016 12zM6.166 7.758a.75.75 0 001.06 1.06l1.591-1.59a.75.75 0 00-1.06-1.061L6.166 7.758z" /></svg>`,
                moon: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path fill-rule="evenodd" d="M9.528 1.718a.75.75 0 01.162.819A8.97 8.97 0 009 6a9 9 0 009 9 8.97 8.97 0 003.463-.69.75.75 0 01.981.98 10.503 10.503 0 01-9.694 6.46c-5.799 0-10.5-4.701-10.5-10.5 0-3.51 1.713-6.636 4.362-8.492a.75.75 0 01.819.162z" clip-rule="evenodd" /></svg>`,
                shieldCheck: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9.661 2.237a.531.531 0 01.678 0 11.947 11.947 0 007.078 2.749.5.5 0 01.479.425c.069.52.104 1.05.104 1.59 0 5.162-3.26 9.563-7.834 11.256a.48.48 0 01-.332 0C5.26 16.564 2 12.163 2 7c0-.538.035-1.069.104-1.589a.5.5 0 01.48-.425 11.947 11.947 0 007.077-2.75zm4.196 5.954a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z" clip-rule="evenodd"/></svg>`,
                github: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor"><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/></svg>`,
                strategyPlus: `<svg class="strategy-accordion-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M10.75 4.75a.75.75 0 00-1.5 0v4.5h-4.5a.75.75 0 000 1.5h4.5v4.5a.75.75 0 001.5 0v-4.5h4.5a.75.75 0 000-1.5h-4.5v-4.5z" /></svg>`,
                strategyMinus: `<svg class="strategy-accordion-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M4 10a.75.75 0 01.75-.75h10.5a.75.75 0 010 1.5H4.75A.75.75 0 014 10z" clip-rule="evenodd" /></svg>`,
                chevron: `<svg class="expand-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M7.21 14.77a.75.75 0 01.02-1.06L11.168 10 7.23 6.29a.75.75 0 111.04-1.08l4.5 4.25a.75.75 0 010 1.08l-4.5 4.25a.75.75 0 01-1.06-.02z" clip-rule="evenodd" /></svg>`,
                audience: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M10 8a3 3 0 100-6 3 3 0 000 6zM3.465 14.493a1.23 1.23 0 00.41 1.412A9.957 9.957 0 0010 18c2.31 0 4.438-.784 6.131-2.095a1.23 1.23 0 00.41-1.412A6.998 6.998 0 0010 11.5a6.998 6.998 0 00-6.535 2.993z" /></svg>`,
                useCase: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M15.988 3.012A2.25 2.25 0 0118 5.25v6.5A2.25 2.25 0 0115.75 14h-3.04a2.252 2.252 0 01-1.523.672c-.675 0-1.284-.28-1.688-.734l-3.328-3.328a2.25 2.25 0 010-3.182l3.328-3.328a2.25 2.25 0 011.688-.734h3.04zM12 9.75a.75.75 0 01.75-.75h.008a.75.75 0 01.75.75v.008a.75.75 0 01-.75.75h-.008a.75.75 0 01-.75-.75v-.008z" clip-rule="evenodd" /><path d="M9.122 7.182a.75.75 0 011.06 0l2.5 2.5a.75.75 0 010 1.06l-2.5 2.5a.75.75 0 01-1.06-1.06L10.81 11H2.75a.75.75 0 010-1.5h8.06l-1.7-1.7a.75.75 0 010-1.06z" clip-rule="evenodd" /></svg>`,
                plug: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M10 2a4 4 0 00-4 4v2a2 2 0 00-2 2v3a2 2 0 002 2h2v5a1 1 0 102 0v-5h2a2 2 0 002-2v-3a2 2 0 00-2-2V6a4 4 0 00-4-4zm-2 6V6a2 2 0 014 0v2H8z"/></svg>`
            };

            let currentView = 'tactic';
            let eligibleTechniques = [];
            let pillars = {};
            let phases = {};

            const viewDescriptions = {
                tactic: {
                    name: 'Tactics View',
                    question: "<strong>What high-level approach and concept is being used for this defense?</strong>",
                    focus: "This view organizes techniques by their strategic security function (i.e. Model, Harden, Detect, Isolate, Deceive, Evict, Restore), aligned with the seven tactics from the MITRE D3FEND™ framework.",
                    audience: "Security Strategists, CISOs, and Security Architects.",
                    useCase: "A security architect is designing a defense-in-depth strategy for a new generative AI service. They use the <strong>Tactics View</strong> to ensure they have a balanced set of controls across the attack lifecycle.<br><br><ul><li>They start with the <strong>'Harden'</strong> tactic to proactively implement controls like Adversarial Training (AID-H-001) and Secure Agent Architecture (AID-H-018).</li><li>Next, they review the <strong>'Detect'</strong> tactic to plan for real-time monitoring, such as implementing Prompt Injection Detection (AID-D-001).</li><li>Finally, they consult the <strong>'Evict'</strong> and <strong>'Restore'</strong> tactics to build playbooks for incident response, like AI Process Eviction (AID-E-002).</li></ul><br>This view helps them identify and close strategic gaps in their defensive plan."
                },
                pillar: {
                    name: 'Pillars View',
                    question: '<strong>What part (component) of the AI system is being protected?</strong>',
                    focus: "This view organizes defenses by the technology stack component they secure: <strong>Data, Model, Infrastructure, or Application</strong>. This component-centric view is aligned with frameworks like Google's Secure AI Framework (SAIF).",
                    audience: "ML Engineers, Data Scientists, and Cloud Security Engineers.",
                    useCase: "A multi-disciplinary AI team needs to assign security responsibilities for their new RAG application. The <strong>Pillars View</strong> allows them to focus on their specific domains.<br><br><ul><li>The <strong>Data Scientist</strong> uses the <strong>'AI Data & Feature Security'</strong> pillar to find techniques for protecting the vector database, such as scanning for poisoned data (AID-E-003).</li><li>The <strong>ML Engineer</strong> consults the <strong>'Model & Algorithm Security'</strong> pillar to harden the embedding model against attacks.</li><li>The <strong>Cloud Engineer</strong> focuses on the <strong>'Infrastructure & Platform Security'</strong> pillar to implement IAM policies (AID-H-004) and network segmentation (AID-I-002).</li></ul><br>This view helps different technical roles quickly find the controls most relevant to their work."
                },
                phase: {
                    name: "Phases View",
                    question: "<strong>When (What stage) in the AI lifecycle should this defense be applied?</strong>",
                    focus: "This view organizes defenses by the development stage where they are most relevant, from initial <strong>Design & Scoping</strong> through <strong>Building, Validation, Operation, Incident Response and System Restoration</strong>.",
                    audience: "MLOps Engineers, Product Managers, and Security/DevSecOps Teams.",
                    useCase: "A company building a new, business-critical AI application from scratch wants to ensure it is <strong>secure by design</strong>. The project lead uses the <strong>Phases View</strong> as their step-by-step security roadmap.<br><br><ul><li>In the project's first week, they use the <strong>'AI System Design & Scoping'</strong> phase to guide their initial threat modeling (AID-M-004) and establish security requirements before development begins.</li><li>As the MLOps team builds the CI/CD pipeline, they consult the <strong>'Model Training, Building & Hardening'</strong> phase to integrate proactive controls like dependency scanning (AID-H-003).</li><li>Before launch, the security team uses the <strong>'Pre-Deployment Validation'</strong> phase to structure their red teaming and assurance activities.</li></ul><br>This process-driven view helps the team apply the right defenses at the right time, ensuring security is embedded throughout the entire AI lifecycle."
                }
            };
            function clearElement(element) {
                while (element.firstChild) {
                    element.removeChild(element.firstChild);
                }
            }
            function createElement(tagName, options = {}) {
                const element = document.createElement(tagName);
                for (const key in options) {
                    if (key === 'className') element.className = options[key];
                    else if (key === 'textContent') element.textContent = options[key];
                    else if (key === 'onclick') element.addEventListener('click', options[key]);
                    else element[key] = options[key];
                }
                return element;
            }
            function setIcon(element, iconKey) {
                if (icons[iconKey]) {
                    element.innerHTML = icons[iconKey];
                }
            }
            function applyTheme(theme) {
                elements.html.classList.toggle('dark', theme === 'dark');
                setIcon(elements.themeToggleBtn, theme === 'dark' ? 'sun' : 'moon');
            }
            function toggleTheme() {
                const newTheme = elements.html.classList.contains('dark') ? 'light' : 'dark';
                localStorage.setItem('aidefendTheme', newTheme);
                applyTheme(newTheme);
            }
            function matchesText(text, term) {
                return text && text.toLowerCase().includes(term);
            }
            function matchesTechnique(tech, term) {
                return matchesText(tech.name, term) ||
                    matchesText(tech.id, term) ||
                    matchesText(tech.description, term) ||
                    (tech.defendsAgainst && tech.defendsAgainst.some(da => da.items && da.items.some(item => matchesText(item, term)))) ||
                    (tech.implementationStrategies && tech.implementationStrategies.some(s => matchesText(s.strategy, term))) ||
                    (tech.toolsOpenSource && tech.toolsOpenSource.some(t => matchesText(t, term))) ||
                    (tech.toolsCommercial && tech.toolsCommercial.some(t => matchesText(t, term)));
            }
            function getFilteredTechniqueIds(searchTerm) {
                if (!searchTerm) return new Set(eligibleTechniques.map(t => t.id));
                const term = searchTerm.toLowerCase();
                const matches = new Set();
                eligibleTechniques.forEach(tech => {
                    if (matchesTechnique(tech, term)) {
                        matches.add(tech.id);
                    }
                });
                return matches;
            }
            function renderMainGrid() {
                clearElement(elements.mainContent);
                const searchTerm = elements.searchBar.value.trim();
                switch (currentView) {
                    case 'pillar':
                        renderPillarGrid(searchTerm);
                        break;
                    case 'phase':
                        renderPhaseGrid(searchTerm);
                        break;
                    case 'tactic':
                    default:
                        renderTacticGrid(searchTerm);
                        break;
                }
            }
            function renderTacticGrid(searchTerm) {
                const gridContainer = createElement('div', { className: 'matrix-grid' });
                const filteredIds = getFilteredTechniqueIds(searchTerm);
                if (searchTerm && filteredIds.size === 0) {
                    gridContainer.appendChild(createElement('p', {
                        className: 'text-center text-gray-500 dark:text-gray-400 py-10',
                        textContent: `No techniques found matching "${searchTerm}".`
                    }));
                    elements.mainContent.appendChild(gridContainer);
                    return;
                }
                aidefendData.tactics.forEach(tactic => {
                    const techniquesToRender = (tactic.techniques || []).filter(tech => {
                        if (!searchTerm) return true;
                        return filteredIds.has(tech.id) || tech.subTechniques?.some(sub => filteredIds.has(sub.id));
                    });
                    if (techniquesToRender.length > 0) {
                        const column = createElement('div', { className: 'matrix-column' });
                        column.style.flexBasis = `13.5%`;
                        const header = createElement('h3', { className: 'column-header', textContent: tactic.name, onclick: () => showTacticModal(tactic) });
                        const ul = createElement('ul');
                        techniquesToRender.forEach(tech => {
                            ul.appendChild(renderTechniqueItem(tech, tactic.name, filteredIds, searchTerm));
                        });
                        column.appendChild(header);
                        column.appendChild(ul);
                        gridContainer.appendChild(column);
                    }
                });
                elements.mainContent.appendChild(gridContainer);
            }
            function renderPillarGrid(searchTerm) {
                const gridContainer = createElement('div', { className: 'matrix-grid' });
                const filteredIds = getFilteredTechniqueIds(searchTerm);
                if (searchTerm && filteredIds.size === 0) {
                    gridContainer.appendChild(createElement('p', {
                        className: 'text-center text-gray-500 dark:text-gray-400 py-10',
                        textContent: `No techniques found matching "${searchTerm}".`
                    }));
                    elements.mainContent.appendChild(gridContainer);
                    return;
                }
                Object.values(pillars).forEach(pillar => {
                    const techniquesToRender = pillar.techniques.filter(tech => !searchTerm || filteredIds.has(tech.id));
                    if (techniquesToRender.length > 0) {
                        const column = createElement('div', { className: 'matrix-column' });
                        column.style.flexBasis = `24%`;
                        const header = createElement('h3', { className: 'column-header', textContent: pillar.name, onclick: () => showPillarOrPhaseModal(pillar) });
                        const ul = createElement('ul');
                        techniquesToRender.forEach(tech => {
                            ul.appendChild(renderTechniqueItem(tech, pillar.name, filteredIds, searchTerm));
                        });
                        column.appendChild(header);
                        column.appendChild(ul);
                        gridContainer.appendChild(column);
                    }
                });
                elements.mainContent.appendChild(gridContainer);
            }
            function renderPhaseGrid(searchTerm) {
                const gridContainer = createElement('div', { className: 'matrix-grid' });
                const filteredIds = getFilteredTechniqueIds(searchTerm);
                // Bug Fix #2: Always render phase columns, but only populate them if they have content.
                // The outer check for empty search results handles the case where nothing matches at all.
                Object.values(phases).forEach(phase => {
                    const column = createElement('div', { className: 'matrix-column' });
                    column.style.flexBasis = `15.5%`;
                    const header = createElement('h3', { className: 'column-header', textContent: phase.name, onclick: () => showPillarOrPhaseModal(phase) });
                    const ul = createElement('ul');
                    const techniquesToRender = phase.techniques.filter(tech => !searchTerm || filteredIds.has(tech.id));
                    if (techniquesToRender.length > 0) {
                        techniquesToRender.forEach(tech => {
                            ul.appendChild(renderTechniqueItem(tech, phase.name, filteredIds, searchTerm));
                        });
                    }
                    column.appendChild(header);
                    column.appendChild(ul);
                    gridContainer.appendChild(column);
                });
                // If the search term is active AND there are no results, show the message.
                // Otherwise, show the grid (even if some columns are empty).
                if (searchTerm && filteredIds.size === 0) {
                    clearElement(gridContainer);
                    gridContainer.appendChild(createElement('p', {
                        className: 'text-center text-gray-500 dark:text-gray-400 py-10',
                        textContent: `No techniques found matching "${searchTerm}".`
                    }));
                }
                elements.mainContent.appendChild(gridContainer);
            }

            function renderTechniqueItem(tech, groupName, filteredIds, searchTerm) {
                const li = createElement('li', { className: 'technique-container' });
                const hasSub = tech.subTechniques && tech.subTechniques.length > 0;
                const itemDiv = createElement('div', {
                    className: `technique-item elevation-2 ${hasSub ? '' : 'no-sub'}`
                });

                const contentDiv = createElement('div', {
                    className: 'technique-item-content',
                    onclick: (e) => {
                        e.stopPropagation();
                        showTechniqueModal(tech, groupName);
                    }
                });
                contentDiv.appendChild(createElement('span', { className: 'technique-id', textContent: tech.id }));
                contentDiv.appendChild(createElement('span', { className: 'technique-name', textContent: tech.name }));
                itemDiv.appendChild(contentDiv);

                const isParentMatch = searchTerm && filteredIds.has(tech.id);
                const hasSubMatch = hasSub && tech.subTechniques.some(sub => filteredIds.has(sub.id));


                if (isParentMatch) {
                    itemDiv.classList.add('highlight');
                }

                if (hasSub) {

                    const showArrow = !searchTerm || hasSubMatch;
                    let iconWrapper;

                    if (showArrow) {
                        iconWrapper = createElement('div', { className: 'expand-icon' });
                        setIcon(iconWrapper, 'chevron');
                        itemDiv.appendChild(iconWrapper);
                    }

                    const subList = createElement('ul', { className: 'sub-technique-list' });
                    tech.subTechniques.forEach(subTech => {
                        const isVisible = !searchTerm || filteredIds.has(subTech.id);
                        if (isVisible) {
                            const subItem = renderSubTechniqueItem(subTech, groupName, filteredIds, searchTerm);
                            subList.appendChild(subItem);
                        }
                    });

                    li.appendChild(itemDiv);
                    li.appendChild(subList);


                    if (searchTerm && hasSubMatch) {
                        itemDiv.classList.add('expanded');
                        subList.classList.add('expanded');
                        if (iconWrapper) {
                            iconWrapper.style.transform = 'rotate(90deg)';
                        }
                        setTimeout(() => subList.style.maxHeight = subList.scrollHeight + "px", 0);
                    }

                    itemDiv.onclick = (e) => {
                        e.stopPropagation();
                        if (showArrow) { // Only allow toggling if the arrow is visible
                            toggleSubTechniques(itemDiv, subList, iconWrapper);
                        }
                    };
                } else {
                    itemDiv.onclick = (e) => {
                        e.stopPropagation();
                        showTechniqueModal(tech, groupName);
                    };
                    li.appendChild(itemDiv);
                }

                return li;
            }

            function toggleSubTechniques(header, content, iconWrapper) {
                const isExpanded = content.classList.toggle('expanded');
                header.classList.toggle('expanded', isExpanded);
                iconWrapper.style.transform = isExpanded ? 'rotate(90deg)' : 'rotate(0deg)';
                content.style.maxHeight = isExpanded ? content.scrollHeight + 'px' : null;
            }
            function renderSubTechniqueItem(subTech, groupName, filteredIds, searchTerm) {
                const subLi = createElement('li');
                const subDiv = createElement('div', {
                    className: 'subtechnique-item elevation-2',
                    onclick: (e) => { e.stopPropagation(); showTechniqueModal(subTech, groupName); }
                });
                subDiv.appendChild(createElement('span', { className: 'technique-id', textContent: subTech.id }));
                subDiv.appendChild(createElement('span', { className: 'technique-name', textContent: subTech.name }));
                if (searchTerm && filteredIds.has(subTech.id)) {
                    subDiv.classList.add('highlight');
                }
                subLi.appendChild(subDiv);
                return subLi;
            }
            function showModal() {
                elements.modal.classList.add('active');
                document.body.classList.add('modal-open');
            }
            function hideModal() {
                elements.modal.classList.remove('active');
                document.body.classList.remove('modal-open');
                clearElement(elements.modalBody);
            }
            function createAccordion(sections, defaultOpenIndex = 0) {
                const container = createElement('div', { className: 'accordion-container' });
                sections.forEach((section, index) => {
                    const item = createElement('div', { className: 'accordion-item' });
                    const header = createElement('div', { className: 'accordion-header', onclick: () => toggleAccordion(content) });
                    const title = createElement('span', { textContent: section.title });
                    const iconWrapper = createElement('div', { className: 'icon-wrapper' });
                    setIcon(iconWrapper, index === defaultOpenIndex ? 'minus' : 'plus');
                    header.appendChild(title);
                    header.appendChild(iconWrapper);
                    const content = createElement('div', { className: 'accordion-content' });
                    const contentInner = createElement('div', { className: 'accordion-content-inner' });
                    if (section.paragraphs) section.paragraphs.forEach(p => contentInner.innerHTML += `<p>${DOMPurify.sanitize(p)}</p>`);
                    if (section.listItems) {
                        const ul = createElement('ul');
                        section.listItems.forEach(item => ul.innerHTML += `<li>${DOMPurify.sanitize(item)}</li>`);
                        contentInner.appendChild(ul);
                    }
                    if (section.concludingParagraphs) section.concludingParagraphs.forEach(p => contentInner.innerHTML += `<p>${DOMPurify.sanitize(p)}</p>`);
                    content.appendChild(contentInner);
                    item.appendChild(header);
                    item.appendChild(content);
                    container.appendChild(item);
                    if (index === defaultOpenIndex) {
                        header.classList.add('active');
                        setTimeout(() => content.style.maxHeight = content.scrollHeight + 'px', 0);
                    }
                });
                return container;
            }
            function toggleAccordion(content) {
                const header = content.previousElementSibling;
                const iconWrapper = header.querySelector('.icon-wrapper');
                const isActive = header.classList.toggle('active');
                content.style.maxHeight = isActive ? content.scrollHeight + 'px' : null;
                setIcon(iconWrapper, isActive ? 'minus' : 'plus');
            }
            function showIntroductionModal() {
                clearElement(elements.modalBody);
                const intro = aidefendData.introduction;
                elements.modalBody.appendChild(createElement('h2', { className: 'modal-main-title', textContent: intro.mainTitle }));
                elements.modalBody.appendChild(createAccordion(intro.sections, 0));
                showModal();
            }
            function showViewInfoModal() {
                clearElement(elements.modalBody);
                elements.modalBody.appendChild(createElement('h2', { className: 'modal-main-title', textContent: 'About the Framework Views' }));
                const tabsContainer = createElement('div', { className: 'view-info-tabs' });
                const contentContainer = createElement('div', { className: 'view-info-content-container' });
                Object.keys(viewDescriptions).forEach((key, index) => {
                    const view = viewDescriptions[key];
                    const tabButton = createElement('button', {
                        className: `view-info-tab ${index === 0 ? 'active' : ''}`,
                        textContent: view.name,
                    });
                    tabButton.dataset.tab = key;
                    tabsContainer.appendChild(tabButton);
                    const contentPane = createElement('div', {
                        id: `tab-content-${key}`,
                        className: `view-info-tab-content ${index === 0 ? 'active' : ''}`
                    });
                    const card = createElement('div', { className: 'view-info-card elevation-2' });
                    card.innerHTML = `
                        <h3>${view.name}</h3>
                        <p class="view-question">${view.question}</p>
                        <p class="view-focus-text">${view.focus}</p>
                        <div class="view-detail">
                            <span class="view-detail-icon">${icons.audience}</span>
                            <div class="view-detail-content"><strong>Target Audience:</strong> ${view.audience}</div>
                        </div>
                        <div class="view-detail">
                            <span class="view-detail-icon">${icons.useCase}</span>
                            <div class="view-detail-content"><strong>Sample Use Case:</strong> ${view.useCase}</div>
                        </div>
                    `;
                    contentPane.appendChild(card);
                    contentContainer.appendChild(contentPane);
                });
                elements.modalBody.appendChild(tabsContainer);
                elements.modalBody.appendChild(contentContainer);
                tabsContainer.addEventListener('click', (e) => {
                    if (e.target.tagName === 'BUTTON') {
                        const tabId = e.target.dataset.tab;
                        tabsContainer.querySelector('.active')?.classList.remove('active');
                        contentContainer.querySelector('.active')?.classList.remove('active');
                        e.target.classList.add('active');
                        document.getElementById(`tab-content-${tabId}`).classList.add('active');
                    }
                });
                showModal();
            }
            function showTacticModal(tactic) {
                clearElement(elements.modalBody);
                const fullTactic = aidefendData.tactics.find(t => t.name === tactic.name) || tactic;
                elements.modalBody.innerHTML = `<h2>${DOMPurify.sanitize(fullTactic.name)}</h2><p class="mb-4 leading-relaxed text-sm">${DOMPurify.sanitize(fullTactic.purpose || 'No purpose description available.')}</p>`;
                showModal();
            }
            function showPillarOrPhaseModal(item) {
                clearElement(elements.modalBody);
                elements.modalBody.innerHTML = `<h2>${DOMPurify.sanitize(item.name)}</h2><p class="mb-4 leading-relaxed text-sm">${DOMPurify.sanitize(item.focus || 'No description available.')}</p>`;
                showModal();
            }
            function showTechniqueModal(technique, groupName) {
                clearElement(elements.modalBody);
                const groupType = currentView.charAt(0).toUpperCase() + currentView.slice(1);
                elements.modalBody.appendChild(createElement('p', { className: 'text-sm opacity-80 mb-1', textContent: `${groupType}: ${groupName}` }));
                elements.modalBody.appendChild(createElement('h2', { textContent: `${technique.id}: ${technique.name}` }));
                const p = createElement('p', { className: 'mb-4 leading-relaxed text-sm' });
                p.innerHTML = DOMPurify.sanitize(technique.description || 'No description available.');
                elements.modalBody.appendChild(p);
                if (technique.warning) {
                    const warningDiv = createElement('div', { className: 'warning-note' });
                    const warningP = createElement('p');
                    warningP.innerHTML = DOMPurify.sanitize(`<strong>💡 Warning: ${technique.warning.level} </strong>${technique.warning.description}`);
                    warningDiv.appendChild(warningP);
                    elements.modalBody.appendChild(warningDiv);
                }
                renderDetailSection('Implementation Strategies', technique.implementationStrategies);
                renderDetailSection('Potential Tools - Open Source', technique.toolsOpenSource);
                renderDetailSection('Potential Tools - Commercial', technique.toolsCommercial);
                renderDefendsAgainstSection(technique.defendsAgainst);
                showModal();
            }
            function renderDetailSection(title, items) {
                if (!items || items.length === 0) return;
                const section = createElement('div', { className: 'mt-4' });
                const titleSize = title.startsWith('Potential Tools') ? 'text-base' : 'text-lg';
                section.appendChild(createElement('h3', { className: `font-semibold ${titleSize} mb-2`, textContent: title + ':' }));
                if (title === 'Implementation Strategies') {
                    const container = createElement('div', { className: 'strategy-accordion-container' });
                    items.forEach(strategy => {
                        const item = createElement('div', { className: 'strategy-accordion-item' });
                        const header = createElement('div', { className: 'strategy-accordion-header', onclick: () => toggleAccordion(content) });
                        const iconWrapper = createElement('div', { className: 'icon-wrapper' });
                        setIcon(iconWrapper, 'strategyPlus');
                        header.appendChild(createElement('span', { textContent: strategy.strategy }));
                        header.appendChild(iconWrapper);
                        const content = createElement('div', { className: 'strategy-accordion-content' });
                        const contentInner = createElement('div', { className: 'strategy-accordion-content-inner' });
                        if (strategy.howTo) { contentInner.innerHTML = DOMPurify.sanitize(strategy.howTo); }
                        content.appendChild(contentInner);
                        item.appendChild(header);
                        item.appendChild(content);
                        container.appendChild(item);
                    });
                    section.appendChild(container);
                } else {
                    const ul = createElement('ul', { className: 'list-disc list-inside ml-4 text-xs opacity-90 space-y-1' });
                    items.forEach(item => {
                        const li = createElement('li');
                        li.textContent = item;
                        ul.appendChild(li);
                    });
                    section.appendChild(ul);
                }
                elements.modalBody.appendChild(section);
            }
            function renderDefendsAgainstSection(defendsAgainst) {
                if (!defendsAgainst || defendsAgainst.length === 0) return;
                const section = createElement('div', { className: 'mt-4' });
                section.appendChild(createElement('h3', { className: 'font-semibold text-base mb-2', textContent: 'Defends Against:' }));
                defendsAgainst.forEach(da => {
                    const daDiv = createElement('div', { className: 'mb-2' });
                    daDiv.innerHTML += `<p class="defends-against-framework">${DOMPurify.sanitize(da.framework)}:</p>`;
                    const itemsList = createElement('div', { className: 'defends-against-list opacity-90' });
                    da.items.forEach(item => itemsList.innerHTML += `<div class="defends-against-item"><span class="defends-against-item-text">${DOMPurify.sanitize(item)}</span></div>`);
                    daDiv.appendChild(itemsList);
                    section.appendChild(daDiv);
                });
                elements.modalBody.appendChild(section);
            }
            function updateContentPadding() {
                const header = document.querySelector('.header-main');
                const contentWrapper = document.getElementById('content-wrapper');
                if (header && contentWrapper) {
                    // Check if we are in the mobile view (screen width < 640px)
                    if (window.innerWidth < 640) {
                        const headerHeight = header.offsetHeight;
                        const extraMargin = 24; // A bit of space
                        contentWrapper.style.paddingTop = `${headerHeight + extraMargin}px`;
                    } else {
                        // We are in desktop view, so remove the inline style
                        // and let the original 'pt-48' class take over.
                        contentWrapper.style.paddingTop = '';
                    }
                }
            }
            function addEventListeners() {
                window.addEventListener('resize', updateContentPadding);
                window.addEventListener('load', updateContentPadding);
                elements.themeToggleBtn.addEventListener('click', toggleTheme);
                elements.aboutBtn.addEventListener('click', showIntroductionModal);
                elements.viewInfoBtn.addEventListener('click', showViewInfoModal);
                elements.viewSwitcher.addEventListener('click', (e) => {
                    if (e.target.tagName === 'BUTTON') {
                        const newView = e.target.dataset.view;
                        if (newView !== currentView) {
                            document.querySelector('.view-switcher-btn.active').classList.remove('active');
                            e.target.classList.add('active');
                            currentView = newView;
                            renderMainGrid();
                        }
                    }
                });
                // Bug Fix #1: Removed debounce timer for instant search response
                elements.searchBar.addEventListener('input', (e) => {
                    const searchTerm = e.target.value.trim();
                    elements.searchClearBtn.style.display = searchTerm ? 'block' : 'none';
                    renderMainGrid();
                });
                elements.searchClearBtn.addEventListener('click', () => {
                    elements.searchBar.value = '';
                    elements.searchClearBtn.style.display = 'none';
                    renderMainGrid();
                });
                elements.modalClose.addEventListener('click', hideModal);
                elements.modalBackdrop.addEventListener('click', hideModal);
                document.addEventListener('keydown', (event) => {
                    if (event.key === 'Escape' && elements.modal.classList.contains('active')) {
                        hideModal();
                    }
                });
            }
            function prepareDataForViews() {
                eligibleTechniques = [];
                pillars = {
                    'data': { name: 'AI Data & Feature Security', focus: 'Securing the entire lifecycle of data, features, and other input assets (e.g., knowledge bases for RAG). This pillar covers data provenance, integrity verification, sanitization, privacy preservation, and defenses against data-centric attacks like poisoning.', techniques: [] },
                    'infra': { name: 'Infrastructure & Platform Security', focus: "Securing the foundational infrastructure and operational platforms that AI systems are built and run on. This includes the hardware, networks, cloud services, container orchestration, and MLOps pipelines. It covers applying security best practices for identity management, isolation, and configuration hardening to the entire AI technology stack.", techniques: [] },
                    'model': { name: 'Model & Algorithm Security', focus: "Protecting the AI model itself as a unique asset. This pillar addresses the intrinsic resilience of the model's architecture and learned parameters against attacks like evasion, model theft, and backdoor insertion. It includes techniques like adversarial training, certified defenses, and robust aggregation algorithms.", techniques: [] },
                    'app': { name: 'Application, Agent & Interface Security', focus: "Securing the application code, prompts, agentic systems, and interfaces that use the model to interact with users and other systems. This pillar covers the newest and most dynamic attack surface, including hardening against prompt injection, ensuring secure tool use by agents, and validating all model inputs and outputs.", techniques: [] }
                };
                phases = {
                    'scoping': { name: 'AI System Design & Scoping', focus: "The foundational \"blueprint\" phase. This involves defining the AI's purpose and architecture, threat modeling its unique risks, inventorying its components (data, models, APIs), and establishing the safety and ethical boundaries that will govern its development and operation.", techniques: [] },
                    'building': { name: 'Model Training, Building & Hardening', focus: "The core construction phase focused on creating a secure and robust AI model. This includes the proactive hardening of data pipelines, the implementation of secure model training, building, or fine-tuning processes, and applying defenses that make the resulting model artifact resilient by design.", techniques: [] },
                    'validation': { name: 'Pre-Deployment Validation & Assurance', focus: "The critical \"security gate\" before going live. This is an adversarial testing and validation phase where the goal is to find and fix vulnerabilities before an attacker does. It involves AI Red Teaming, formal verification of security controls, and gaining assurance that the model behaves safely.", techniques: [] },
                    'operation': { name: 'Production Operation & Monitoring', focus: "The active, real-time defense of the AI system in a live production environment. This is about continuous observation to detect attacks, monitor for performance and data drift, and ensure the system is operating within its expected parameters.", techniques: [] },
                    'response': { name: 'Incident Containment & Eviction', focus: "The immediate, tactical response to a confirmed security incident. The goal is to \"stop the bleeding\" as quickly as possible. This involves actions like isolating a rogue agent, quarantining a user, blocking an attack, and kicking the adversary out of the system.", techniques: [] },
                    'improvement': { name: 'System Restoration & Improvement', focus: "The methodical, post-containment process of safely returning to normal operation and learning from the incident. This includes restoring models and data from trusted backups, performing a root cause analysis, and hardening defenses to prevent recurrence.", techniques: [] }
                };

                aidefendData.tactics.forEach(tactic => {
                    tactic.techniques?.forEach(tech => {
                        // ALWAYS add the parent technique to the searchable list.
                        eligibleTechniques.push({ ...tech, tactic: tactic.name });

                        const subTechniques = tech.subTechniques || [];

                        if (subTechniques.length > 0) {
                            // If there are sub-techniques, they are the "leaf nodes" for Pillars/Phases views.
                            subTechniques.forEach(sub => {
                                const fullSub = { ...sub, parent: tech, tactic: tactic.name };

                                // Add the sub-technique to the searchable list.
                                eligibleTechniques.push(fullSub);

                                // Add the sub-technique to the relevant Pillar and Phase buckets.
                                fullSub.pillar?.forEach(p => pillars[p]?.techniques.push(fullSub));
                                fullSub.phase?.forEach(ph => phases[ph]?.techniques.push(fullSub));
                            });
                        } else {
                            // If there are NO sub-techniques, the parent itself is the "leaf node".
                            const fullTech = { ...tech, tactic: tactic.name };

                            // Add the parent technique to the relevant Pillar and Phase buckets.
                            fullTech.pillar?.forEach(p => pillars[p]?.techniques.push(fullTech));
                            fullTech.phase?.forEach(ph => phases[ph]?.techniques.push(fullTech));
                        }
                    });
                });
            }
            function initialize() {
                const savedTheme = localStorage.getItem('aidefendTheme') || 'dark';
                applyTheme(savedTheme);
                const aboutIcon = createElement('span');
                setIcon(aboutIcon, 'shieldCheck');
                const svg = aboutIcon.querySelector('svg');
                if (svg) {
                    svg.style.width = '1rem';
                    svg.style.height = '1rem';
                    svg.style.marginRight = '0.5rem';
                }
                elements.aboutBtn.insertBefore(aboutIcon, elements.aboutBtn.firstChild);
                // Add GitHub icon
                const githubLink = document.getElementById('githubLink');
                if (githubLink) {
                    const githubIcon = createElement('span');
                    setIcon(githubIcon, 'github');
                    const githubSvg = githubIcon.querySelector('svg');
                    if (githubSvg) {
                        githubSvg.style.width = '1rem';
                        githubSvg.style.height = '1rem';
                        githubSvg.style.marginRight = '0.5rem';
                    }
                    githubLink.insertBefore(githubIcon, githubLink.firstChild);
                }
                // Add MCP icon
                const mcpLink = document.getElementById('mcpLink');
                if (mcpLink) {
                    const mcpIcon = createElement('span');
                    setIcon(mcpIcon, 'plug');
                    const mcpSvg = mcpIcon.querySelector('svg');
                    if (mcpSvg) {
                        mcpSvg.style.width = '1rem';
                        mcpSvg.style.height = '1rem';
                        mcpSvg.style.marginRight = '0.5rem';
                    }
                    mcpLink.insertBefore(mcpIcon, mcpLink.firstChild);
                }
                const versionSection = aidefendData.introduction.sections.find(s => s.title === "Version & Date");
                if (versionSection && versionSection.paragraphs.length > 0) {
                    const versionString = versionSection.paragraphs[0];
                    const versionElement = document.getElementById('framework-version');
                    if (versionElement) {
                        versionElement.textContent = versionString;
                    }
                }
                prepareDataForViews();
                renderMainGrid();
                addEventListeners();
                updateContentPadding();
            }
            initialize();
        };
    </script>
</body>

</html>